<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>What happens when (2): from C&#43;&#43; source code to executables | Jifan&#39;s Blog</title>
<meta name="keywords" content="Programming, C&#43;&#43;" />
<meta name="description" content="TL,DR;
 Writing code.  Tool: plain text editor, like VS Code, Vim. Result: source code, .cpp file.   Compiling source code to object file.  Tool: complier, like GCC, Clang. Result: intermediate object file, .o/.obj file.   Link object file to executable.  Tool: linker. Result: executable file, no extension on UNIX-like systems (MacOS) and Linux or .exe on Windows.     Coding  Write a piece of human-readable C&#43;&#43; code in your editor, and save it as hello.">
<meta name="author" content="Jifan">
<link rel="canonical" href="https://jifan.tech/posts/2022-05-19-the-programming-process/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.d2d913f96f20672531467f8a00a1afae6af2b44b8ba24b7a5cab31330f0bcb2c.css" integrity="sha256-0tkT&#43;W8gZyUxRn&#43;KAKGvrmrytEuLokt6XKsxMw8Lyyw=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://jifan.tech/imgs/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jifan.tech/imgs/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jifan.tech/imgs/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jifan.tech/imgs/apple-touch-icon.png">
<link rel="mask-icon" href="https://jifan.tech/imgs/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="What happens when (2): from C&#43;&#43; source code to executables" />
<meta property="og:description" content="TL,DR;
 Writing code.  Tool: plain text editor, like VS Code, Vim. Result: source code, .cpp file.   Compiling source code to object file.  Tool: complier, like GCC, Clang. Result: intermediate object file, .o/.obj file.   Link object file to executable.  Tool: linker. Result: executable file, no extension on UNIX-like systems (MacOS) and Linux or .exe on Windows.     Coding  Write a piece of human-readable C&#43;&#43; code in your editor, and save it as hello." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jifan.tech/posts/2022-05-19-the-programming-process/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-19T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-05-19T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="What happens when (2): from C&#43;&#43; source code to executables"/>
<meta name="twitter:description" content="TL,DR;
 Writing code.  Tool: plain text editor, like VS Code, Vim. Result: source code, .cpp file.   Compiling source code to object file.  Tool: complier, like GCC, Clang. Result: intermediate object file, .o/.obj file.   Link object file to executable.  Tool: linker. Result: executable file, no extension on UNIX-like systems (MacOS) and Linux or .exe on Windows.     Coding  Write a piece of human-readable C&#43;&#43; code in your editor, and save it as hello."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://jifan.tech/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "What happens when (2): from C++ source code to executables",
      "item": "https://jifan.tech/posts/2022-05-19-the-programming-process/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "What happens when (2): from C++ source code to executables",
  "name": "What happens when (2): from C\u002b\u002b source code to executables",
  "description": "TL,DR;\n Writing code.  Tool: plain text editor, like VS Code, Vim. Result: source code, .cpp file.   Compiling source code to object file.  Tool: complier, like GCC, Clang. Result: intermediate object file, .o/.obj file.   Link object file to executable.  Tool: linker. Result: executable file, no extension on UNIX-like systems (MacOS) and Linux or .exe on Windows.     Coding  Write a piece of human-readable C++ code in your editor, and save it as hello.",
  "keywords": [
    "Programming", "C++"
  ],
  "articleBody": " TL,DR;\n Writing code.  Tool: plain text editor, like VS Code, Vim. Result: source code, .cpp file.   Compiling source code to object file.  Tool: complier, like GCC, Clang. Result: intermediate object file, .o/.obj file.   Link object file to executable.  Tool: linker. Result: executable file, no extension on UNIX-like systems (MacOS) and Linux or .exe on Windows.     Coding  Write a piece of human-readable C++ code in your editor, and save it as hello.cpp.  // header file #include // macro #define MY_STRING \"Hello World\" #define MY_MAX(a, b) (a  b ? a : b)  // main function int main() { // print some characters on your screen  std::cout  MY_STRING  std::endl; // comparison of two number  int a = 1, b = 2; std::cout  \"a = \"  a  \", b = \"  b; std::cout  \", MY_MAX(a, b) = \"  MY_MAX(a, b)  std::endl; // return and quit  return 0; }  Then, use a handy tool to convert it into an executable file, named hello.  gcc -o hello hello.cpp -lstdc++  Run this executable file and you will get the output of the program.  Hello World a = 1, b = 2, MY_MAX(a, b) = 2  Isn’t it amazing? But have you ever wondered what happens when the source code becomes an executable? The chart below shows the changes during this process, which will be described in detail later.   From source code to executables (source)\n  Pre-processing  Pre-processing is mandatory in C/C++. Pre-processing will handle # directives:  File inclusion with nested inclusion (#include) Conditional compilation (e.g., #if, #endif, #ifndef) and macro expansion (#define)   Pre-process will delete all comments. In this case: /usr/include/iostream and all files are included by it are inserted and the contained macros expanded. Use -E flag (meas only run the preprocessor) to stop after pre-processing: gcc -E -o hello.pp.cpp hello.cpp And we will get the following pre-processed results, please note: # 1 \"hello.cpp\" # 1 \"\" 1 # 1 \"\" 3 # 379 \"\" 3 # 1 \"\" 1 # 1 \"\" 2 # 1 \"hello.cpp\" 2  # 1 \"/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/iostream\" 1 3# 36 \"/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/iostream\" 3# 1 \"/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/__config\" 1 3# 57 \"/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/__config\" 3# 469 \"/Library/Developer/CommandLineTools/usr/bin/../include/c++/v1/__config\" 3typedef __char16_t char16_t; typedef __char32_t char32_t; /* -------------------------------------- */ /* Tens of thousands of lines are omitted */ /* -------------------------------------- */ # 3 \"hello.cpp\" 2  int main() { std::cout  \"Hello World\"  std::endl; int a = 1, b = 2; std::cout  \"a = \"  a  \", b = \"  b; std::cout  \", MY_MAX(a, b) = \"  (a  b ? a : b)  std::endl; return 0; }  All included header files are inserted, making hello.pp.cpp contain far more lines of code than hello.cpp. All macros have been replaced and all comments deleted. The int main() { line is preceded by five blank lines, which is exactly the number of lines between it and the last #include directive (macros and comments have been removed). Since this program is running on macOS 10.15 and GCC for macOS actually executes Clang, your results may differ from mine. ❯ gcc -v Configured with: --prefix=/Library/Developer/CommandLineTools/usr --with-gxx-include-dir=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/4.2.1 Apple clang version 12.0.0 (clang-1200.0.32.2) Target: x86_64-apple-darwin19.6.0 Thread model: posix InstalledDir: /Library/Developer/CommandLineTools/usr/bin     Compilation  Compiler converts a high-level language into the specific instruction set of the target CPU. Individual steps:  Parse text (lexical + syntactical analysis). Do language specific transformation. Translate to internal representation units (IRs). Optimization (reorder, merge, eliminate). Replace IRs with pieces of assembler language.   The intermediate result after compilation, named hello.s, is obtained with the following instructions (-S flag means compiling source code into assembler instructions). gcc -S hello.cpp  On my machine, hello.s contains thousands of lines of assembly code. And Compiler Explorer provides a cleaner and more readable result.   Assembler \u0026 Linker  Assembler (as) translates assembly to binary.  Creates so-called object files (in ELF format). Generate binary hello.o with the following instruction (-c flag means compiling source code without linking) gcc -c hello.cpp  “nm” can list symbols from object files. nm hello.o Some of the results are shown below: 0000000000000e40 s GCC_except_table39 0000000000000ddc s GCC_except_table4 0000000000000e54 s GCC_except_table44 0000000000000e1c s GCC_except_table7 U __Unwind_Resume 0000000000000a90 t __ZNKSt3__112basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEE13__get_pointerEv 0000000000000b30 t __ZNKSt3__112basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEE18__get_long_pointerEv # ----- Dozens of lines were omitted ----- 00000000000000e0 T __ZNSt3__1lsINS_11char_traitsIcEEEERNS_13basic_ostreamIcT_EES6_PKc U __ZSt9terminatev 00000000000007d0 T ___clang_call_terminate U ___cxa_begin_catch U ___cxa_call_unexpected U ___cxa_end_catch U ___gxx_personality_v0 0000000000000000 T _main U _strlen    Linker (ld) puts binary together with startup code and required libraries. The final step to generate the executable file: gcc -o hello hello.o -lstdc++  Note that gcc -o hello hello.o will fail with “symbol(s) not found”. This is because std::cout is in libstdc++, but compiler does not link to it. -l searchs the library named  when linking.    References  The Programming Process From Source Code to Executable - Dr. Axel Kohlmeyer  ",
  "wordCount" : "790",
  "inLanguage": "en",
  "datePublished": "2022-05-19T00:00:00Z",
  "dateModified": "2022-05-19T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Jifan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jifan.tech/posts/2022-05-19-the-programming-process/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jifan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jifan.tech/imgs/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jifan.tech" accesskey="h" title="Jifan&#39;s Blog (Alt + H)">Jifan&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jifan.tech/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://jifan.tech/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://jifan.tech/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">












<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://jifan.tech">Home</a>&nbsp;»&nbsp;<a href="https://jifan.tech/posts/">Posts</a></div>
    <h1 class="post-title">
      What happens when (2): from C&#43;&#43; source code to executables
    </h1>
    <div class="post-meta"><span title='2022-05-19 00:00:00 +0000 UTC'>May 19, 2022</span>&nbsp;·&nbsp;Jifan

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#coding" aria-label="Coding">Coding</a></li>
                <li>
                    <a href="#pre-processing" aria-label="Pre-processing">Pre-processing</a></li>
                <li>
                    <a href="#compilation" aria-label="Compilation">Compilation</a></li>
                <li>
                    <a href="#assembler--linker" aria-label="Assembler &amp;amp; Linker">Assembler &amp; Linker</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p><strong>TL,DR;</strong></p>
<ul>
<li>Writing code.
<ul>
<li>Tool: plain text editor, like <a href="https://code.visualstudio.com">VS Code</a>, <a href="https://www.vim.org">Vim</a>.</li>
<li>Result: source code, <code>.cpp</code> file.</li>
</ul>
</li>
<li>Compiling source code to object file.
<ul>
<li>Tool: complier, like <a href="https://gcc.gnu.org">GCC</a>, <a href="https://clang.llvm.org">Clang</a>.</li>
<li>Result: intermediate object file, <code>.o</code>/<code>.obj</code> file.</li>
</ul>
</li>
<li>Link object file to executable.
<ul>
<li>Tool: linker.</li>
<li>Result: executable file, no extension on UNIX-like systems (MacOS)
and Linux or <code>.exe</code> on Windows.</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="coding">Coding<a hidden class="anchor" aria-hidden="true" href="#coding">#</a></h1>
<ul>
<li>Write a piece of human-readable C++ code in your editor, and save it as <code>hello.cpp</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// header file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// macro
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define MY_STRING &#34;Hello World&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define MY_MAX(a, b) (a &gt; b ? a : b)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// main function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// print some characters on your screen
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">MY_STRING</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// comparison of two number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, MY_MAX(a, b) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">MY_MAX</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// return and quit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Then, use a handy tool to convert it into an executable file, named <code>hello</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -o hello hello.cpp -lstdc++
</span></span></code></pre></div><ul>
<li>Run this executable file and you will get the output of the program.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">Hello World
</span></span><span class="line"><span class="cl">a = 1, b = 2, MY_MAX(a, b) = 2
</span></span></code></pre></div><ul>
<li>Isn&rsquo;t it amazing? But have you ever wondered what happens when the source code becomes an executable?</li>
<li>The chart below shows the changes during this process, which will be described in detail later.</li>
</ul>
<figure class="align-center ">
    <img loading="lazy" src="http://oberon00.github.io/cpptutorial/_images/tikz-0832773d28c1fe7f613b4e6d18cb85967f9fd8cc.png#center"
         alt="From source code to executables (source)" width="80%"/> <figcaption>
            <p>From source code to executables (<a href="http://oberon00.github.io/cpptutorial/_images/tikz-0832773d28c1fe7f613b4e6d18cb85967f9fd8cc.png">source</a>)</p>
        </figcaption>
</figure>

<h1 id="pre-processing">Pre-processing<a hidden class="anchor" aria-hidden="true" href="#pre-processing">#</a></h1>
<ul>
<li>Pre-processing is <strong>mandatory</strong> in C/C++.</li>
<li>Pre-processing will handle <code>#</code> directives:
<ul>
<li>File inclusion with nested inclusion (<code>#include</code>)</li>
<li>Conditional compilation (e.g., <code>#if</code>, <code>#endif</code>, <code>#ifndef</code>)  and macro expansion (<code>#define</code>)</li>
</ul>
</li>
<li>Pre-process will delete all comments.</li>
<li>In this case: <code>/usr/include/iostream</code> and all files are included by it are inserted and the contained macros expanded.</li>
<li>Use <code>-E</code> flag (meas only run the preprocessor) to stop after pre-processing:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -E -o hello.pp.cpp hello.cpp
</span></span></code></pre></div>And we will get the following pre-processed results, please note:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp"># 1 &#34;hello.cpp&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;&lt;built-in&gt;&#34; 1
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;&lt;built-in&gt;&#34; 3
</span></span></span><span class="line"><span class="cl"><span class="cp"># 379 &#34;&lt;built-in&gt;&#34; 3
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;&lt;command line&gt;&#34; 1
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;&lt;built-in&gt;&#34; 2
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;hello.cpp&#34; 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;/Library/Developer/CommandLineTools/usr/bin/../include</span><span class="cpf">/c++/v1/iostream&#34; 1 3</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"># 36 &#34;/Library/Developer/CommandLineTools/usr/bin/../include</span><span class="cpf">/c++/v1/iostream&#34; 3</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"># 1 &#34;/Library/Developer/CommandLineTools/usr/bin/../include</span><span class="cpf">/c++/v1/__config&#34; 1 3</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"># 57 &#34;/Library/Developer/CommandLineTools/usr/bin/../include</span><span class="cpf">/c++/v1/__config&#34; 3</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"># 469 &#34;/Library/Developer/CommandLineTools/usr/bin/../include</span><span class="cpf">/c++/v1/__config&#34; 3</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">typedef</span> <span class="n">__char16_t</span> <span class="kt">char16_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="n">__char32_t</span> <span class="kt">char32_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* -------------------------------------- */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* Tens of thousands of lines are omitted */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* -------------------------------------- */</span>
</span></span><span class="line"><span class="cl"><span class="cp"># 3 &#34;hello.cpp&#34; 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Hello World&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, b = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;, MY_MAX(a, b) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>All included header files are inserted, making <code>hello.pp.cpp</code> contain far more lines of code than <code>hello.cpp</code>.</li>
<li>All macros have been replaced and all comments deleted.</li>
<li>The <code>int main() {</code> line is preceded by five blank lines, which is exactly the number of lines between it and the last <code>#include</code> directive (macros and comments have been removed).</li>
<li>Since this program is running on macOS 10.15 and GCC for macOS actually executes Clang, your results may differ from mine.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">❯ gcc -v                                                                 
</span></span><span class="line"><span class="cl">Configured with: --prefix<span class="o">=</span>/Library/Developer/CommandLineTools/usr --with-gxx-include-dir<span class="o">=</span>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/4.2.1
</span></span><span class="line"><span class="cl">Apple clang version 12.0.0 <span class="o">(</span>clang-1200.0.32.2<span class="o">)</span>
</span></span><span class="line"><span class="cl">Target: x86_64-apple-darwin19.6.0
</span></span><span class="line"><span class="cl">Thread model: posix
</span></span><span class="line"><span class="cl">InstalledDir: /Library/Developer/CommandLineTools/usr/bin
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h1 id="compilation">Compilation<a hidden class="anchor" aria-hidden="true" href="#compilation">#</a></h1>
<ul>
<li>Compiler converts a high-level language into the specific instruction set of the target CPU.</li>
<li>Individual steps:
<ul>
<li>Parse text (lexical + syntactical analysis).</li>
<li>Do language specific transformation.</li>
<li>Translate to internal representation units (IRs).</li>
<li>Optimization (reorder, merge, eliminate).</li>
<li>Replace IRs with pieces of <a href="https://en.wikipedia.org/wiki/Assembly_language">assembler language</a>.</li>
</ul>
</li>
<li>The intermediate result after compilation, named <code>hello.s</code>, is obtained with the following instructions (<code>-S</code> flag means compiling source code into assembler instructions).
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -S hello.cpp 
</span></span></code></pre></div></li>
<li>On my machine, <code>hello.s</code> contains thousands of lines of assembly code. And <a href="https://godbolt.org/z/eqM374nv6">Compiler Explorer</a> provides a cleaner and more readable result.</li>
</ul>

<iframe width="800px" height="400px" src="https://godbolt.org/e#g:!%28%28g:!%28%28g:!%28%28h:codeEditor,i:%28filename:%271%27,fontScale:8,fontUsePx:%270%27,j:1,lang:c%2B%2B,selection:%28endColumn:2,endLineNumber:19,positionColumn:2,positionLineNumber:19,selectionStartColumn:2,selectionStartLineNumber:19,startColumn:2,startLineNumber:19%29,source:%27//&#43;header&#43;file%0A%23include&#43;%3Ciostream%3E%0A//&#43;macro%0A%23define&#43;MY_STRING&#43;%22Hello&#43;World%22%0A%23define&#43;MY_MAX%28a,&#43;b%29&#43;%28a&#43;%3E&#43;b&#43;%3F&#43;a&#43;:&#43;b%29%0A%0A//&#43;main&#43;function%0Aint&#43;main%28%29&#43;%7B%0A&#43;&#43;&#43;&#43;//&#43;print&#43;some&#43;characters&#43;on&#43;your&#43;screen%0A&#43;&#43;&#43;&#43;std::cout&#43;%3C%3C&#43;MY_STRING&#43;%3C%3C&#43;std::endl%3B%0A%0A&#43;&#43;&#43;&#43;//&#43;comparison&#43;of&#43;two&#43;number%0A&#43;&#43;&#43;&#43;int&#43;a&#43;%3D&#43;1,&#43;b&#43;%3D&#43;2%3B%0A&#43;&#43;&#43;&#43;std::cout&#43;%3C%3C&#43;%22a&#43;%3D&#43;%22&#43;%3C%3C&#43;a&#43;%3C%3C&#43;%22,&#43;b&#43;%3D&#43;%22&#43;%3C%3C&#43;b%3B%0A&#43;&#43;&#43;&#43;std::cout&#43;%3C%3C&#43;%22,&#43;MY_MAX%28a,&#43;b%29&#43;%3D&#43;%22&#43;%3C%3C&#43;MY_MAX%28a,&#43;b%29&#43;%3C%3C&#43;std::endl%3B%0A%0A&#43;&#43;&#43;&#43;//&#43;return&#43;and&#43;quit%0A&#43;&#43;&#43;&#43;return&#43;0%3B%0A%7D%27%29,l:%275%27,n:%270%27,o:%27C%2B%2B&#43;source&#43;%231%27,t:%270%27%29%29,k:50,l:%274%27,n:%270%27,o:%27%27,s:0,t:%270%27%29,%28g:!%28%28h:compiler,i:%28compiler:clang1200,filters:%28b:%270%27,binary:%271%27,commentOnly:%270%27,demangle:%270%27,directives:%270%27,execute:%271%27,intel:%270%27,libraryCode:%270%27,trim:%271%27%29,flagsViewOpen:%271%27,fontScale:8,fontUsePx:%270%27,j:1,lang:c%2B%2B,libs:!%28%29,options:%27%27,selection:%28endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1%29,source:1,tree:%271%27%29,l:%275%27,n:%270%27,o:%27x86-64&#43;clang&#43;12.0.0&#43;%28C%2B%2B,&#43;Editor&#43;%231,&#43;Compiler&#43;%231%29%27,t:%270%27%29%29,k:50,l:%274%27,n:%270%27,o:%27%27,s:0,t:%270%27%29%29,l:%272%27,n:%270%27,o:%27%27,t:%270%27%29%29,version:4"></iframe>
<h1 id="assembler--linker">Assembler &amp; Linker<a hidden class="anchor" aria-hidden="true" href="#assembler--linker">#</a></h1>
<ul>
<li>Assembler (as) translates assembly to binary.
<ul>
<li>Creates so-called <strong>object files</strong> (in <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF format</a>).</li>
<li>Generate binary <code>hello.o</code> with the following instruction (<code>-c</code> flag means compiling source code without linking)
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -c hello.cpp
</span></span></code></pre></div></li>
<li>&ldquo;<a href="https://man7.org/linux/man-pages/man1/nm.1.html">nm</a>&rdquo; can list symbols from object files.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nm hello.o
</span></span></code></pre></div>Some of the results are shown below:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">0000000000000e40 s GCC_except_table39
</span></span><span class="line"><span class="cl">0000000000000ddc s GCC_except_table4
</span></span><span class="line"><span class="cl">0000000000000e54 s GCC_except_table44
</span></span><span class="line"><span class="cl">0000000000000e1c s GCC_except_table7
</span></span><span class="line"><span class="cl">                 U __Unwind_Resume
</span></span><span class="line"><span class="cl">0000000000000a90 t __ZNKSt3__112basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEE13__get_pointerEv
</span></span><span class="line"><span class="cl">0000000000000b30 t __ZNKSt3__112basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEE18__get_long_pointerEv
</span></span><span class="line"><span class="cl"># ----- Dozens of lines were omitted -----
</span></span><span class="line"><span class="cl">00000000000000e0 T __ZNSt3__1lsINS_11char_traitsIcEEEERNS_13basic_ostreamIcT_EES6_PKc
</span></span><span class="line"><span class="cl">                 U __ZSt9terminatev
</span></span><span class="line"><span class="cl">00000000000007d0 T ___clang_call_terminate
</span></span><span class="line"><span class="cl">                 U ___cxa_begin_catch
</span></span><span class="line"><span class="cl">                 U ___cxa_call_unexpected
</span></span><span class="line"><span class="cl">                 U ___cxa_end_catch
</span></span><span class="line"><span class="cl">                 U ___gxx_personality_v0
</span></span><span class="line"><span class="cl">0000000000000000 T _main
</span></span><span class="line"><span class="cl">                 U _strlen
</span></span></code></pre></div></li>
</ul>
</li>
<li>Linker (ld) puts binary together with startup code and required libraries.</li>
<li>The final step to generate the executable file:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -o hello hello.o -lstdc++
</span></span></code></pre></div><ul>
<li>Note that <code>gcc -o hello hello.o</code> will fail with &ldquo;symbol(s) not found&rdquo;. This is because <code>std::cout</code> is in libstdc++, but compiler does not link to it.</li>
<li><code>-l&lt;library&gt;</code> searchs the library named <code>&lt;library&gt;</code> when linking.</li>
</ul>
</li>
</ul>
<h1 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h1>
<ul>
<li><a href="http://www2.hawaii.edu/~takebaya/ics111/process_of_programming/process_of_programming.html">The Programming Process</a></li>
<li><a href="https://www.ictp.it/media/539402/HPC-Appointment-6.pdf">From Source Code to Executable - Dr. Axel Kohlmeyer</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://jifan.tech">Jifan&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            
            throwOnError : false
        });
    });
</script>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>